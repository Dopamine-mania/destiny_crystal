<view class="container">
  <view wx:if="{{isLoading}}" class="loading">
    <text class="loading-icon">â³</text>
    <text class="loading-text">æ­£åœ¨ç”Ÿæˆæ‚¨çš„å‘½ç†æŠ¥å‘Š...</text>
  </view>

  <view wx:else class="report-content">
    <view class="header">
      <view class="title">
        <text class="icon">âœ¨</text>
        <text class="title-text">{{userInfo.name}} çš„å‘½ç†æŠ¥å‘Š</text>
      </view>
      <text class="subtitle">åŸºäºå››æŸ±å‘½ç†å­¦AIåˆ†æ</text>
    </view>

    <!-- å…è´¹å†…å®¹ï¼šäº”è¡Œåˆ†å¸ƒå›¾ -->
    <view class="section">
      <view class="section-title">ğŸ”¥ äº”è¡ŒåŠ›é‡åˆ†å¸ƒ</view>
      <view class="elements-chart">
        <view wx:for="{{baziReport.freeContent.elements.distribution}}" wx:key="index" class="element-bar">
          <view class="element-name">{{item[0]}}</view>
          <view class="element-progress">
            <view class="element-fill" style="width: {{item[1]}}%"></view>
          </view>
          <text class="element-value">{{item[1]}}%</text>
        </view>
      </view>
    </view>

    <!-- å…è´¹å†…å®¹ï¼šæ—¥ä¸»åˆ†æ -->
    <view class="section">
      <view class="section-title">ğŸŒŸ æ—¥ä¸»åˆ†æ</view>
      <view class="day-master-card">
        <view class="day-master-main">
          <text class="day-master-text">{{baziReport.freeContent.dayMaster.element}}</text>
        </view>
        <text class="day-master-desc">{{baziReport.freeContent.dayMaster.description}}</text>
      </view>
    </view>

    <!-- å…è´¹å†…å®¹ï¼šäº”è¡ŒåŒç±»å¼‚ç±»åˆ†æ (æ—­æ—¥å›¾) -->
    <view class="section">
      <view class="section-title">â˜¯ï¸ äº”è¡ŒåŒç±»å¼‚ç±»åˆ†æ</view>
      <view class="sunburst-chart">
        <view class="sunburst-container">
          <view class="inner-circle">
            <text class="center-text">{{baziReport.freeContent.elements.strength.judgment}}</text>
          </view>
          <view class="outer-ring">
            <view class="ring-section same-section" style="--percentage: {{baziReport.freeContent.elements.strength.sameTotal}}%">
              <view class="section-label">
                <text class="section-title-text">åŒç±»</text>
                <view class="elements-list">
                  <text wx:for="{{baziReport.freeContent.elements.strength.same}}" wx:key="index" class="element-chip">{{item}}</text>
                </view>
                <text class="section-percentage">{{baziReport.freeContent.elements.strength.sameTotal}}%</text>
              </view>
            </view>
            <view class="ring-section different-section" style="--percentage: {{baziReport.freeContent.elements.strength.differentTotal}}%">
              <view class="section-label">
                <text class="section-title-text">å¼‚ç±»</text>
                <view class="elements-list">
                  <text wx:for="{{baziReport.freeContent.elements.strength.different}}" wx:key="index" class="element-chip">{{item}}</text>
                </view>
                <text class="section-percentage">{{baziReport.freeContent.elements.strength.differentTotal}}%</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å…è´¹å†…å®¹ï¼šäº”è¡Œæ—ºè¡°åˆ¤æ–­ -->
    <view class="section">
      <view class="section-title">ğŸ“Š äº”è¡Œæ—ºè¡°åˆ¤æ–­</view>
      <view class="strength-judgment">
        <view class="judgment-card">
          <view class="judgment-result">
            <text class="result-text">{{baziReport.freeContent.elements.strength.judgment}}</text>
          </view>
          <view class="judgment-details">
            <view class="detail-row">
              <text class="detail-label">åŒç±»åŠ›é‡:</text>
              <view class="strength-bar">
                <view class="strength-fill same-fill" style="width: {{baziReport.freeContent.elements.strength.sameTotal}}%"></view>
              </view>
              <text class="detail-value">{{baziReport.freeContent.elements.strength.sameTotal}}%</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">å¼‚ç±»åŠ›é‡:</text>
              <view class="strength-bar">
                <view class="strength-fill different-fill" style="width: {{baziReport.freeContent.elements.strength.differentTotal}}%"></view>
              </view>
              <text class="detail-value">{{baziReport.freeContent.elements.strength.differentTotal}}%</text>
            </view>
          </view>
          <view class="judgment-conclusion">
            <text class="conclusion-text">
              {{baziReport.freeContent.elements.strength.sameTotal > baziReport.freeContent.elements.strength.differentTotal ? 'åŒç±»åŠ›é‡è¾ƒå¼ºï¼Œæ—¥ä¸»åæ—º' : 'å¼‚ç±»åŠ›é‡è¾ƒå¼ºï¼Œæ—¥ä¸»åå¼±'}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- å…è´¹å†…å®¹ï¼šäº”è¡Œå¹³è¡¡å¤©å¹³ -->
    <view class="section">
      <view class="section-title">âš–ï¸ äº”è¡Œå¹³è¡¡å¤©å¹³</view>
      <view class="balance-scale {{scaleAnimated ? \"animated\" : \"\"}}">
        <view class="scale-container">
          <view class="scale-beam"></view>
          <view class="scale-center">âš–ï¸</view>
          
          <!-- å·¦è¾¹å¤©å¹³ç›˜ (åŒç±») -->
          <view class="scale-pan left-pan">
            <view class="pan-content">
              <text class="pan-label">åŒç±» (åŠ©åŠ›)</text>
              <text class="pan-weight">{{baziReport.freeContent.balanceScale.leftSide.weight}}%</text>
              <view class="element-weights">
                <view 
                  wx:for="{{baziReport.freeContent.elements.strength.same}}" 
                  wx:key="index" 
                  class="weight-item clickable"
                  bindtap="onScaleElementTap"
                  data-element="{{item}}"
                >
                  <text class="weight-value">{{Math.round(baziReport.freeContent.balanceScale.leftSide.weight / baziReport.freeContent.elements.strength.same.length)}}g</text>
                  <text class="weight-element">{{item}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- å³è¾¹å¤©å¹³ç›˜ (å¼‚ç±») -->
          <view class="scale-pan right-pan">
            <view class="pan-content">
              <text class="pan-label">å¼‚ç±» (å‹åŠ›)</text>
              <text class="pan-weight">{{baziReport.freeContent.balanceScale.rightSide.weight}}%</text>
              <view class="element-weights">
                <view 
                  wx:for="{{baziReport.freeContent.elements.strength.different}}" 
                  wx:key="index" 
                  class="weight-item clickable"
                  bindtap="onScaleElementTap"
                  data-element="{{item}}"
                >
                  <text class="weight-value">{{Math.round(baziReport.freeContent.balanceScale.rightSide.weight / baziReport.freeContent.elements.strength.different.length)}}g</text>
                  <text class="weight-element">{{item}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å¤©å¹³è¯´æ˜ -->
        <view class="scale-explanation">
          <text class="explanation-text">ğŸ’¡ ç‚¹å‡»å¤©å¹³ä¸Šçš„ç ç æŸ¥çœ‹å¯¹åº”äº”è¡Œçš„è¯¦ç»†è¯´æ˜</text>
        </view>
      </view>
    </view>

    <!-- ä»˜è´¹å¢™ -->
    <view wx:if="{{!isPremiumUser}}" class="paywall-section">
      <view class="paywall-divider">
        <text class="divider-text">ä»¥ä¸‹å†…å®¹éœ€è¦è§£é”æ·±åº¦åˆ†æ</text>
      </view>
      
      <view class="locked-preview">
        <view class="preview-item">
          <text class="preview-title">ğŸ™ å–œç”¨ç¥åˆ†æ</text>
          <text class="preview-content">æ·±åº¦åˆ†ææ‚¨çš„å–œç”¨ç¥å’Œå¿Œç¥...</text>
          <view class="lock-overlay">ğŸ”’</view>
        </view>
      </view>

      <view class="unlock-buttons {{paywallHighlight ? \"highlight\" : \"\"}}">
        <button class="unlock-btn" bindtap="onUnlockPremium" data-type="single">
          <text class="btn-title">å•æ¨¡å—è§£é” Â¥9.9</text>
        </button>
        <button class="unlock-btn premium" bindtap="onUnlockPremium" data-type="annual">
          <text class="btn-title">å¹´åº¦ä¼šå‘˜ Â¥99.9</text>
        </button>
      </view>
    </view>

    <!-- ä»˜è´¹å†…å®¹ (è§£é”åæ˜¾ç¤º) -->
    <view wx:if="{{isPremiumUser}}" class="premium-sections">
      <view class="section">
        <view class="section-title">ğŸ™ å–œç”¨ç¥æ·±åº¦åˆ†æ</view>
        <view class="premium-content">
          <text class="analysis-text">{{baziReport.premiumContent.favorableGods.analysis}}</text>
          <view class="gods-tags">
            <text wx:for="{{baziReport.premiumContent.favorableGods.favorable}}" wx:key="index" 
                  class="god-tag favorable">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- æ°´æ™¶æ¨è -->
      <view class="section crystal-section">
        <view class="section-title">ğŸ’ ä¸“å±è¡¥è¿æ°´æ™¶</view>
        <view class="crystal-intro">
          <text class="intro-text">æ ¹æ®æ‚¨çš„å–œç”¨ç¥ã€Œ{{baziReport.premiumContent.favorableGods.favorable.join('ã€')}}ã€ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹æ°´æ™¶:</text>
          <button class="explore-crystals-btn" bindtap="onExploreCrystals">
            <text class="btn-icon">ğŸ”</text>
            <text class="btn-text">æ¢ç´¢æ›´å¤šæ°´æ™¶</text>
          </button>
        </view>
        <view class="crystals-grid">
          <view wx:for="{{baziReport.crystalRecommendations}}" wx:key="index" class="crystal-card">
            <view class="crystal-header">
              <view class="crystal-name">{{item.name}}</view>
              <view class="element-badge element-{{item.element}}">{{item.element}}</view>
            </view>
            <view class="crystal-price">Â¥{{item.price}}</view>
            <view class="crystal-desc">{{item.description}}</view>
            <view class="crystal-actions">
              <button class="add-cart-btn" bindtap="onAddToCart" data-crystal="{{item}}">
                <text class="cart-icon">ğŸ›’</text>
                <text>åŠ è´­ç‰©è½¦</text>
              </button>
              <button class="buy-now-btn" bindtap="onBuyNow" data-crystal="{{item}}">
                <text class="buy-icon">âš¡</text>
                <text>ç«‹å³è´­ä¹°</text>
              </button>
            </view>
          </view>
        </view>
        
        <!-- æ°´æ™¶å•†åŸå…¥å£ -->
        <view class="crystal-mall-entry">
          <button class="mall-entry-btn" bindtap="onExploreCrystals">
            <view class="entry-content">
              <text class="entry-icon">ğŸ’</text>
              <view class="entry-text">
                <text class="entry-title">æ°´æ™¶å•†åŸ</text>
                <text class="entry-desc">å‘ç°æ›´å¤šç¬¦åˆæ‚¨å‘½ç†çš„æ°´æ™¶</text>
              </view>
              <text class="entry-arrow">â†’</text>
            </view>
          </button>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="actions">
      <button class="action-btn secondary" bindtap="onBack">è¿”å›</button>
      <button wx:if="{{isPremiumUser}}" class="action-btn primary" bindtap="onViewCart">
        æŸ¥çœ‹è´­ç‰©è½¦
      </button>
    </view>
  </view>
</view>
